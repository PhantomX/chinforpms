From a708e15c7ca5a0d8c49b7c9bdb49451e5f3d8d6b Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Tue, 23 Nov 2021 21:45:47 -0300
Subject: [PATCH] Use system libraries

---
 src/ARMJIT.cpp     | 3 +--
 src/CMakeLists.txt | 9 +++++++--
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/src/ARMJIT.cpp b/src/ARMJIT.cpp
index 2f9cad9..47a9a29 100644
--- a/src/ARMJIT.cpp
+++ b/src/ARMJIT.cpp
@@ -22,8 +22,7 @@
 #include <assert.h>
 #include <unordered_map>
 
-#define XXH_STATIC_LINKING_ONLY
-#include "xxhash/xxhash.h"
+#include "xxhash.h"
 
 #include "Platform.h"
 
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 16c68e1..da50c4a 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -57,9 +57,14 @@ add_library(core STATIC
 	
 	sha1/sha1.c
 	tiny-AES-c/aes.c
-	xxhash/xxhash.c
 )
 
+find_package(PkgConfig REQUIRED)
+pkg_check_modules(XXHASH REQUIRED libxxhash)
+
+target_include_directories(core PRIVATE ${XXHASH_INCLUDE_DIRS})
+target_link_libraries(core ${XXHASH_LIBRARIES})
+
 if (ENABLE_OGLRENDERER)
 	target_sources(core PRIVATE
 		GPU_OpenGL.cpp
@@ -137,4 +142,4 @@ endif()
 
 if (ENABLE_JIT_PROFILING)
 	target_link_libraries(core jitprofiling)
-endif()
\ No newline at end of file
+endif()
-- 
2.33.1

