From 431a6da8bd581b2ab44214d1c2096a70fd520927 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Sat, 8 Jun 2019 20:34:37 -0300
Subject: [PATCH] Disable GConf2 magnet registering

This breaks GConf free systems
---
 deluge/ui/gtk3/common.py | 30 +-----------------------------
 1 file changed, 1 insertion(+), 29 deletions(-)

diff --git a/deluge/ui/gtk3/common.py b/deluge/ui/gtk3/common.py
index 757c3de..c75288e 100644
--- a/deluge/ui/gtk3/common.py
+++ b/deluge/ui/gtk3/common.py
@@ -260,35 +260,7 @@ def associate_magnet_links(overwrite=False):
     # Don't try associate magnet on OSX see: #2420
     elif not osx_check():
         # gconf method is only available in a GNOME environment
-        try:
-            import gi
-
-            gi.require_version('GConf', '2.0')
-            from gi.repository import GConf
-        except ValueError:
-            log.debug(
-                'gconf not available, so will not attempt to register magnet uri handler'
-            )
-            return False
-        else:
-            key = '/desktop/gnome/url-handlers/magnet/command'
-            gconf_client = GConf.Client.get_default()
-            if (gconf_client.get(key) and overwrite) or not gconf_client.get(key):
-                # We are either going to overwrite the key, or do it if it hasn't been set yet
-                if gconf_client.set_string(key, 'deluge "%s"'):
-                    gconf_client.set_bool(
-                        '/desktop/gnome/url-handlers/magnet/needs_terminal', False
-                    )
-                    gconf_client.set_bool(
-                        '/desktop/gnome/url-handlers/magnet/enabled', True
-                    )
-                    log.info('Deluge registered as default magnet uri handler!')
-                    return True
-                else:
-                    log.error(
-                        'Unable to register Deluge as default magnet uri handler.'
-                    )
-                    return False
+        return True
     return False
 
 
-- 
2.21.0

