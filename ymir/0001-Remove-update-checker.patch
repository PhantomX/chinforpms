From 76884a15e019777700bf6cdaaef9fcd464114132 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Sat, 11 Oct 2025 17:38:43 -0300
Subject: [PATCH] Remove update checker

---
 apps/ymir-sdl3/CMakeLists.txt                 |  9 ---------
 apps/ymir-sdl3/src/app/app.cpp                | 20 +++++--------------
 apps/ymir-sdl3/src/app/app.hpp                | 11 ----------
 apps/ymir-sdl3/src/app/events/gui_event.hpp   |  2 --
 .../src/app/events/gui_event_factory.hpp      |  4 ----
 apps/ymir-sdl3/src/app/settings.cpp           |  7 -------
 apps/ymir-sdl3/src/app/settings.hpp           |  2 --
 apps/ymir-sdl3/src/app/shared_context.hpp     |  5 ++---
 .../views/settings/general_settings_view.cpp  |  4 ++--
 .../src/app/ui/windows/about_window.cpp       | 19 ------------------
 10 files changed, 9 insertions(+), 74 deletions(-)

diff --git a/apps/ymir-sdl3/CMakeLists.txt b/apps/ymir-sdl3/CMakeLists.txt
index 988daee..f9845e7 100644
--- a/apps/ymir-sdl3/CMakeLists.txt
+++ b/apps/ymir-sdl3/CMakeLists.txt
@@ -21,8 +21,6 @@ add_executable(ymir-sdl3
     src/app/shared_context.hpp
     src/app/stb_implementations.cpp
     src/app/toml_implementation.cpp
-    src/app/update_checker.cpp
-    src/app/update_checker.hpp
 
     src/app/debug/cdblock_tracer.cpp
     src/app/debug/cdblock_tracer.hpp
@@ -222,10 +220,6 @@ add_executable(ymir-sdl3
     src/app/ui/windows/settings_window.hpp
     src/app/ui/windows/system_state_window.cpp
     src/app/ui/windows/system_state_window.hpp
-    src/app/ui/windows/update_onboarding_window.cpp
-    src/app/ui/windows/update_onboarding_window.hpp
-    src/app/ui/windows/update_window.cpp
-    src/app/ui/windows/update_window.hpp
 
     src/app/ui/windows/debug/cdblock_cmd_trace_window.cpp
     src/app/ui/windows/debug/cdblock_cmd_trace_window.hpp
@@ -352,8 +346,6 @@ endif()
 find_package(cereal CONFIG REQUIRED)
 find_package(cxxopts CONFIG REQUIRED)
 find_package(date CONFIG REQUIRED)
-find_package(OpenSSL CONFIG REQUIRED)
-find_package(CURL REQUIRED)
 find_package(fmt CONFIG REQUIRED)
 find_package(rtmidi CONFIG)
 if(NOT rtmidi_FOUND)
@@ -389,7 +381,6 @@ target_link_libraries(ymir-sdl3 PRIVATE
     cereal::cereal
     lz4::lz4
     RtMidi::rtmidi
-    CURL::libcurl
 )
 if (WIN32)
     target_link_libraries(ymir-sdl3 PRIVATE
diff --git a/apps/ymir-sdl3/src/app/app.cpp b/apps/ymir-sdl3/src/app/app.cpp
index 25cf20c..b269c64 100644
--- a/apps/ymir-sdl3/src/app/app.cpp
+++ b/apps/ymir-sdl3/src/app/app.cpp
@@ -168,9 +168,7 @@ App::App()
     , m_debugOutputWindow(m_context)
     , m_settingsWindow(m_context)
     , m_periphConfigWindow(m_context)
-    , m_aboutWindow(m_context)
-    , m_updateOnboardingWindow(m_context)
-    , m_updateWindow(m_context) {
+    , m_aboutWindow(m_context) {
 
     // Preinitialize some memory viewers
     for (int i = 0; i < 8; i++) {
@@ -456,6 +454,7 @@ void App::RunEmulator() {
 
     lsn::CScopedNoSubnormals snsNoSubnormals{};
 
+#if 0
     {
         const auto updaterPath = m_context.profile.GetPath(ProfilePath::PersistentState) / "updates";
         const auto onboardedPath = updaterPath / ".onboarded";
@@ -490,6 +489,7 @@ void App::RunEmulator() {
             m_updateCheckerThread.join();
         }
     }};
+#endif
 
     // Get embedded file system
     auto embedfs = cmrc::Ymir_sdl3_rc::get_filesystem();
@@ -2155,8 +2155,6 @@ void App::RunEmulator() {
                 break;
             }
 
-            case EvtType::CheckForUpdates: CheckForUpdates(true); break;
-
             case EvtType::StateLoaded:
                 m_context.DisplayMessage(fmt::format("State {} loaded", std::get<uint32>(evt.value) + 1));
                 break;
@@ -2802,9 +2800,6 @@ void App::RunEmulator() {
                     if (ImGui::MenuItem("Open welcome window", nullptr)) {
                         OpenWelcomeModal(false);
                     }
-                    if (ImGui::MenuItem("Check for updates", nullptr)) {
-                        CheckForUpdates(true);
-                    }
 
                     ImGui::Separator();
 #if Ymir_ENABLE_IMGUI_DEMO
@@ -3598,6 +3593,7 @@ void App::ScreenshotThread() {
     }
 }
 
+#if 0
 void App::UpdateCheckerThread() {
     util::SetCurrentThreadName("Update checker thread");
 
@@ -3712,6 +3708,7 @@ void App::UpdateCheckerThread() {
         }
     }
 }
+#endif
 
 void App::OpenWelcomeModal(bool scanIPLROMs) {
     bool activeScanning = scanIPLROMs;
@@ -3869,11 +3866,6 @@ void App::OpenWelcomeModal(bool scanIPLROMs) {
     });
 }
 
-void App::CheckForUpdates(bool skipCache) {
-    m_updateCheckMode = skipCache ? UpdateCheckMode::OnlineNoCache : UpdateCheckMode::Online;
-    m_updateCheckEvent.Set();
-}
-
 void App::RebindInputs() {
     m_context.settings.RebindInputs();
 }
@@ -4881,8 +4873,6 @@ void App::DrawWindows() {
     m_settingsWindow.Display();
     m_periphConfigWindow.Display();
     m_aboutWindow.Display();
-    m_updateOnboardingWindow.Display();
-    m_updateWindow.Display();
 }
 
 void App::OpenMemoryViewer() {
diff --git a/apps/ymir-sdl3/src/app/app.hpp b/apps/ymir-sdl3/src/app/app.hpp
index c734a25..dfd19f6 100644
--- a/apps/ymir-sdl3/src/app/app.hpp
+++ b/apps/ymir-sdl3/src/app/app.hpp
@@ -9,8 +9,6 @@
 #include "ui/windows/peripheral_config_window.hpp"
 #include "ui/windows/settings_window.hpp"
 #include "ui/windows/system_state_window.hpp"
-#include "ui/windows/update_onboarding_window.hpp"
-#include "ui/windows/update_window.hpp"
 
 #include "ui/windows/debug/cdblock_window_set.hpp"
 #include "ui/windows/debug/debug_output_window.hpp"
@@ -71,19 +69,12 @@ private:
     std::mutex m_screenshotQueueMtx;
     bool m_screenshotThreadRunning;
 
-    std::thread m_updateCheckerThread;
-    util::Event m_updateCheckEvent;
-    UpdateCheckMode m_updateCheckMode;
-    bool m_updateCheckerThreadRunning;
-
     void RunEmulator();
 
     void EmulatorThread();
     void ScreenshotThread();
-    void UpdateCheckerThread();
 
     void OpenWelcomeModal(bool scanIPLROMS);
-    void CheckForUpdates(bool skipCache);
 
     void RebindInputs();
 
@@ -171,8 +162,6 @@ private:
     ui::SettingsWindow m_settingsWindow;
     ui::PeripheralConfigWindow m_periphConfigWindow;
     ui::AboutWindow m_aboutWindow;
-    ui::UpdateOnboardingWindow m_updateOnboardingWindow;
-    ui::UpdateWindow m_updateWindow;
 
     // -------------------------------------------------------------------------
     // Generic modal dialog
diff --git a/apps/ymir-sdl3/src/app/events/gui_event.hpp b/apps/ymir-sdl3/src/app/events/gui_event.hpp
index 13031f3..493236f 100644
--- a/apps/ymir-sdl3/src/app/events/gui_event.hpp
+++ b/apps/ymir-sdl3/src/app/events/gui_event.hpp
@@ -79,8 +79,6 @@ struct GUIEvent {
         TryLoadCDBlockROM,
         ReloadCDBlockROM,
 
-        CheckForUpdates,
-
         TakeScreenshot,
 
         // Emulator notifications
diff --git a/apps/ymir-sdl3/src/app/events/gui_event_factory.hpp b/apps/ymir-sdl3/src/app/events/gui_event_factory.hpp
index faa54fa..aa82790 100644
--- a/apps/ymir-sdl3/src/app/events/gui_event_factory.hpp
+++ b/apps/ymir-sdl3/src/app/events/gui_event_factory.hpp
@@ -103,10 +103,6 @@ inline GUIEvent ReloadCDBlockROM() {
     return {.type = GUIEvent::Type::ReloadCDBlockROM};
 }
 
-inline GUIEvent CheckForUpdates() {
-    return {.type = GUIEvent::Type::CheckForUpdates};
-}
-
 inline GUIEvent TakeScreenshot() {
     return {.type = GUIEvent::Type::TakeScreenshot};
 }
diff --git a/apps/ymir-sdl3/src/app/settings.cpp b/apps/ymir-sdl3/src/app/settings.cpp
index e7ebb14..7904233 100644
--- a/apps/ymir-sdl3/src/app/settings.cpp
+++ b/apps/ymir-sdl3/src/app/settings.cpp
@@ -670,9 +670,6 @@ void Settings::ResetToDefaults() {
 
     general.pauseWhenUnfocused = false;
 
-    general.checkForUpdates = false;
-    general.includeNightlyBuilds = false;
-
     gui.overrideUIScale = false;
     gui.uiScale = 1.0;
     gui.rememberWindowGeometry = true;
@@ -839,8 +836,6 @@ SettingsLoadResult Settings::Load(const std::filesystem::path &path) {
         Parse(tblGeneral, "AltSpeedFactor", general.altSpeedFactor);
         Parse(tblGeneral, "UseAltSpeed", general.useAltSpeed);
         Parse(tblGeneral, "PauseWhenUnfocused", general.pauseWhenUnfocused);
-        Parse(tblGeneral, "CheckForUpdates", general.checkForUpdates);
-        Parse(tblGeneral, "IncludeNightlyBuilds", general.includeNightlyBuilds);
 
         general.screenshotScale = std::clamp(general.screenshotScale, 1, 4);
 
@@ -1214,8 +1209,6 @@ SettingsSaveResult Settings::Save() {
             {"AltSpeedFactor", general.altSpeedFactor.Get()},
             {"UseAltSpeed", general.useAltSpeed.Get()},
             {"PauseWhenUnfocused", general.pauseWhenUnfocused},
-            {"CheckForUpdates", general.checkForUpdates},
-            {"IncludeNightlyBuilds", general.includeNightlyBuilds},
 
             {"PathOverrides", toml::table{{
                 {"IPLROMImages", m_context.profile.GetPathOverride(ProfilePath::IPLROMImages).native()},
diff --git a/apps/ymir-sdl3/src/app/settings.hpp b/apps/ymir-sdl3/src/app/settings.hpp
index 4f2c1f9..168d116 100644
--- a/apps/ymir-sdl3/src/app/settings.hpp
+++ b/apps/ymir-sdl3/src/app/settings.hpp
@@ -152,8 +152,6 @@ struct Settings {
 
         bool pauseWhenUnfocused;
 
-        bool checkForUpdates;
-        bool includeNightlyBuilds;
     } general;
 
     struct GUI {
diff --git a/apps/ymir-sdl3/src/app/shared_context.hpp b/apps/ymir-sdl3/src/app/shared_context.hpp
index ef26505..4b1c155 100644
--- a/apps/ymir-sdl3/src/app/shared_context.hpp
+++ b/apps/ymir-sdl3/src/app/shared_context.hpp
@@ -6,7 +6,6 @@
 #include <app/rewind_buffer.hpp>
 #include <app/rom_manager.hpp>
 #include <app/settings.hpp>
-#include <app/update_checker.hpp>
 
 #include <app/input/input_context.hpp>
 #include <app/input/input_utils.hpp>
@@ -462,8 +461,8 @@ struct SharedContext {
 
     Profile profile;
     Settings settings{*this};
-    UpdateChecker updateChecker;
 
+#if 0
     struct Updates {
         bool inProgress = false;
         std::optional<UpdateInfo> latestStable;
@@ -475,6 +474,7 @@ struct SharedContext {
         ReleaseChannel channel;
     };
     std::optional<TargetUpdate> targetUpdate = std::nullopt;
+#endif
 
     ROMManager romManager;
     std::filesystem::path iplRomPath;
@@ -518,7 +518,6 @@ struct SharedContext {
         std::mutex messages;
         std::mutex breakpoints;
         std::mutex watchpoints;
-        std::mutex updates;
     } locks;
 
     struct State {
diff --git a/apps/ymir-sdl3/src/app/ui/views/settings/general_settings_view.cpp b/apps/ymir-sdl3/src/app/ui/views/settings/general_settings_view.cpp
index fc341a3..505c96f 100644
--- a/apps/ymir-sdl3/src/app/ui/views/settings/general_settings_view.cpp
+++ b/apps/ymir-sdl3/src/app/ui/views/settings/general_settings_view.cpp
@@ -127,7 +127,7 @@ void GeneralSettingsView::Display() {
         m_context.displayScale);
 
     // -----------------------------------------------------------------------------------------------------------------
-
+#if 0
     ImGui::PushFont(m_context.fonts.sansSerif.bold, m_context.fontSizes.large);
     ImGui::SeparatorText("Updates");
     ImGui::PopFont();
@@ -187,7 +187,7 @@ void GeneralSettingsView::Display() {
     } else {
         ImGui::TextUnformatted("You are already using the latest version.");
     }
-
+#endif
     // -----------------------------------------------------------------------------------------------------------------
 
     ImGui::PushFont(m_context.fonts.sansSerif.bold, m_context.fontSizes.large);
diff --git a/apps/ymir-sdl3/src/app/ui/windows/about_window.cpp b/apps/ymir-sdl3/src/app/ui/windows/about_window.cpp
index b344da6..fe714e3 100644
--- a/apps/ymir-sdl3/src/app/ui/windows/about_window.cpp
+++ b/apps/ymir-sdl3/src/app/ui/windows/about_window.cpp
@@ -11,17 +11,10 @@
 
 // Includes for versions only
 #include <SDL3/SDL.h>
-#include <curl/curlver.h>
 #include <cxxopts.hpp>
 #include <fmt/format.h>
 #include <lz4.h>
-#include <nghttp2/nghttp2ver.h>
-#include <nghttp3/version.h>
-#include <ngtcp2/version.h>
-#include <nlohmann/json.hpp>
-#include <openssl/opensslv.h>
 #include <RtMidi.h>
-#include <semver.hpp>
 #include <toml++/toml.hpp>
 #include <xxhash.h>
 
@@ -30,16 +23,12 @@
 #define BROTLI_VERSION "1.1.0" // Not exported
 #define CEREAL_VERSION "1.3.2" // Not exported
 #define CMRC_VERSION "2.0.0"   // Not exported
-#define CURL_VERSION _STR(LIBCURL_VERSION_MAJOR) "." _STR(LIBCURL_VERSION_MINOR) "." _STR(LIBCURL_VERSION_PATCH)
 #define CXXOPTS_VERSION _STR(CXXOPTS__VERSION_MAJOR) "." _STR(CXXOPTS__VERSION_MINOR) "." _STR(CXXOPTS__VERSION_PATCH)
 #define DATE_VERSION "3.0.4" // Not exported
 #define IMGUI_VERSION_FULL IMGUI_VERSION " (" _STR(IMGUI_VERSION_NUM) ")"
 #define LZMA_VERSION "24.05" // Private dependency of libchdr
 #define MIO_VERSION "1.1.0"  // Not exported
-#define NLOHMANN_JSON_VERSION \
-    _STR(NLOHMANN_JSON_VERSION_MAJOR) "." _STR(NLOHMANN_JSON_VERSION_MINOR) "." _STR(NLOHMANN_JSON_VERSION_PATCH)
 #define SDL_VERSION_STR _STR(SDL_MAJOR_VERSION) "." _STR(SDL_MINOR_VERSION) "." _STR(SDL_MICRO_VERSION)
-#define SEMVER_VERSION _STR(SEMVER_VERSION_MAJOR) "." _STR(SEMVER_VERSION_MINOR) "." _STR(SEMVER_VERSION_PATCH)
 #define STB_IMAGE_VERSION "2.30"       // Not exported
 #define STB_IMAGE_WRITE_VERSION "1.16" // Not exported
 #define MC_CONCQUEUE_VERSION "1.0.4"   // Not exported
@@ -80,7 +69,6 @@ inline constexpr License licenseBSD3        {.name = "BSD-3-Clause",  .url = "ht
 //inline constexpr License licenseBSL         {.name = "BSL-1.0", .      url = "https://opensource.org/license/bsl-1-0"};
 //inline constexpr License licenseISC         {.name = "ISC",           .url = "https://opensource.org/licenses/ISC"};
 inline constexpr License licenseMIT         {.name = "MIT",           .url = "https://opensource.org/licenses/MIT"};
-inline constexpr License licenseMITCurl     {.name = "MIT-cURL",      .url = "https://github.com/curl/curl/blob/master/COPYING"};
 inline constexpr License licenseMITRtMidi   {.name = "MIT-RtMidi",    .url = "https://github.com/thestk/rtmidi/blob/master/LICENSE"};
 inline constexpr License licensePublicDomain{.name = "Public domain", .url = nullptr};
 //inline constexpr License licenseUnlicense   {.name = "Unlicense",     .url = "https://opensource.org/licenses/unlicense"};
@@ -99,7 +87,6 @@ static const struct {
     {.name = "Brotli",                        .version = BROTLI_VERSION,             .license = licenseMIT,           .repoURL = "https://github.com/google/brotli",               .licenseURL = "https://github.com/google/brotli/blob/master/LICENSE"},
     {.name = "cereal",                        .version = CEREAL_VERSION,             .license = licenseBSD3,          .repoURL = "https://github.com/USCiLab/cereal",              .licenseURL = "https://github.com/USCiLab/cereal/blob/master/LICENSE",                  .homeURL = "https://uscilab.github.io/cereal/index.html"},
     {.name = "CMakeRC",                       .version = CMRC_VERSION,               .license = licenseMIT,           .repoURL = "https://github.com/vector-of-bool/cmrc",         .licenseURL = "https://github.com/vector-of-bool/cmrc/blob/master/LICENSE.txt"},
-    {.name = "curl",                          .version = CURL_VERSION,               .license = licenseMITCurl,       .repoURL = "https://github.com/curl/curl",                   .licenseURL = "https://github.com/curl/curl/blob/master/COPYING",                       .homeURL = "https://curl.se/"},
     {.name = "cxxopts",                       .version = CXXOPTS_VERSION,            .license = licenseMIT,           .repoURL = "https://github.com/jarro2783/cxxopts",           .licenseURL = "https://github.com/jarro2783/cxxopts/blob/master/LICENSE"},
     {.name = "date",                          .version = DATE_VERSION,               .license = licenseMIT,           .repoURL = "https://github.com/HowardHinnant/date",          .licenseURL = "https://github.com/HowardHinnant/date/blob/master/LICENSE.txt"},
     {.name = "Dear ImGui",                    .version = IMGUI_VERSION_FULL,         .license = licenseMIT,           .repoURL = "https://github.com/ocornut/imgui",               .licenseURL = "https://github.com/ocornut/imgui/blob/master/LICENSE.txt"},
@@ -110,12 +97,6 @@ static const struct {
     {.name = "lzma",                          .version = LZMA_VERSION,               .license = licensePublicDomain,                                                                                                                                                       .homeURL = "https://www.7-zip.org/sdk.html",},
     {.name = "mio",                           .version = MIO_VERSION,                .license = licenseMIT,           .repoURL = "https://github.com/StrikerX3/mio",               .licenseURL = "https://github.com/StrikerX3/mio/blob/master/LICENSE"},
     {.name = "moodycamel::\nConcurrentQueue", .version = "\n" MC_CONCQUEUE_VERSION,  .license = licenseBSD2,          .repoURL = "https://github.com/cameron314/concurrentqueue",  .licenseURL = "https://github.com/cameron314/concurrentqueue/blob/master/LICENSE.md"},
-    {.name = "Neargye/semver",                .version = SEMVER_VERSION,             .license = licenseMIT,           .repoURL = "https://github.com/Neargye/semver",              .licenseURL = "https://github.com/Neargye/semver/blob/master/LICENSE"},
-    {.name = "nghttp2",                       .version = NGHTTP2_VERSION,            .license = licenseMIT,           .repoURL = "https://github.com/nghttp2/nghttp2",             .licenseURL = "https://github.com/nghttp2/nghttp2/blob/master/COPYING",                 .homeURL = "https://nghttp2.org/"},
-    {.name = "nghttp3",                       .version = NGHTTP3_VERSION,            .license = licenseMIT,           .repoURL = "https://github.com/ngtcp2/nghttp3",              .licenseURL = "https://github.com/ngtcp2/nghttp3/blob/main/COPYING",                    .homeURL = "https://nghttp2.org/nghttp3/"},
-    {.name = "ngtcp2",                        .version = NGTCP2_VERSION,             .license = licenseMIT,           .repoURL = "https://github.com/ngtcp2/ngtcp2",               .licenseURL = "https://github.com/ngtcp2/ngtcp2/blob/main/COPYING",                     .homeURL = "https://nghttp2.org/ngtcp2/"},
-    {.name = "nlohmann/json",                 .version = NLOHMANN_JSON_VERSION,      .license = licenseMIT,           .repoURL = "https://github.com/nlohmann/json",               .licenseURL = "https://github.com/nlohmann/json/blob/develop/LICENSE.MIT",              .homeURL = "https://json.nlohmann.me/"},
-    {.name = "OpenSSL",                       .version = OPENSSL_FULL_VERSION_STR,   .license = licenseApache2_0,     .repoURL = "https://github.com/openssl/openssl",             .licenseURL = "https://github.com/openssl/openssl/blob/master/LICENSE.txt",             .homeURL = "https://www.openssl.org/"},
     {.name = "RtMidi",                        .version = RTMIDI_VERSION,             .license = licenseMITRtMidi,     .repoURL = "https://github.com/thestk/rtmidi",               .licenseURL = "https://github.com/thestk/rtmidi/blob/master/LICENSE"},
     {.name = "SDL3",                          .version = SDL_VERSION_STR,            .license = licenseZlib,          .repoURL = "https://github.com/libsdl-org/SDL",              .licenseURL = "https://github.com/libsdl-org/SDL/blob/main/LICENSE.txt"},
     {.name = "SDL_GameControllerDB",                                                 .license = licenseZlib,          .repoURL = "https://github.com/mdqinc/SDL_GameControllerDB", .licenseURL = "https://github.com/mdqinc/SDL_GameControllerDB/blob/master/LICENSE"},
-- 
2.51.0

