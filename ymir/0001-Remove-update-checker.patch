From 1bd03c8e985594e4523054da580178caa57aea70 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Sat, 11 Oct 2025 17:38:43 -0300
Subject: [PATCH] Remove update checker

---
 apps/ymir-sdl3/CMakeLists.txt                 |  9 --------
 apps/ymir-sdl3/src/app/app.cpp                | 22 +++++--------------
 apps/ymir-sdl3/src/app/app.hpp                | 11 ----------
 apps/ymir-sdl3/src/app/events/gui_event.hpp   |  2 --
 .../src/app/events/gui_event_factory.hpp      |  4 ----
 apps/ymir-sdl3/src/app/settings.cpp           |  7 ------
 apps/ymir-sdl3/src/app/settings.hpp           |  2 --
 apps/ymir-sdl3/src/app/shared_context.hpp     |  6 ++---
 .../views/settings/general_settings_view.cpp  |  4 ++--
 .../src/app/ui/windows/about_window.cpp       | 19 ----------------
 10 files changed, 9 insertions(+), 77 deletions(-)

diff --git a/apps/ymir-sdl3/CMakeLists.txt b/apps/ymir-sdl3/CMakeLists.txt
index 4ce74cb..3ce56f6 100644
--- a/apps/ymir-sdl3/CMakeLists.txt
+++ b/apps/ymir-sdl3/CMakeLists.txt
@@ -23,8 +23,6 @@ add_executable(ymir-sdl3
     src/app/shared_context.hpp
     src/app/stb_implementations.cpp
     src/app/toml_implementation.cpp
-    src/app/update_checker.cpp
-    src/app/update_checker.hpp
 
     src/app/debug/cdblock_tracer.cpp
     src/app/debug/cdblock_tracer.hpp
@@ -238,10 +236,6 @@ add_executable(ymir-sdl3
     src/app/ui/windows/settings_window.hpp
     src/app/ui/windows/system_state_window.cpp
     src/app/ui/windows/system_state_window.hpp
-    src/app/ui/windows/update_onboarding_window.cpp
-    src/app/ui/windows/update_onboarding_window.hpp
-    src/app/ui/windows/update_window.cpp
-    src/app/ui/windows/update_window.hpp
 
     src/app/ui/windows/debug/cdblock_cmd_trace_window.cpp
     src/app/ui/windows/debug/cdblock_cmd_trace_window.hpp
@@ -371,8 +365,6 @@ endif()
 find_package(cereal CONFIG REQUIRED)
 find_package(cxxopts CONFIG REQUIRED)
 find_package(date CONFIG REQUIRED)
-find_package(OpenSSL CONFIG REQUIRED)
-find_package(CURL REQUIRED)
 find_package(fmt CONFIG REQUIRED)
 find_package(rtmidi CONFIG)
 if(NOT rtmidi_FOUND)
@@ -408,7 +400,6 @@ target_link_libraries(ymir-sdl3 PRIVATE
     cereal::cereal
     lz4::lz4
     RtMidi::rtmidi
-    CURL::libcurl
 )
 if (WIN32)
     target_link_libraries(ymir-sdl3 PRIVATE
diff --git a/apps/ymir-sdl3/src/app/app.cpp b/apps/ymir-sdl3/src/app/app.cpp
index 9b548d7..dfbb790 100644
--- a/apps/ymir-sdl3/src/app/app.cpp
+++ b/apps/ymir-sdl3/src/app/app.cpp
@@ -173,9 +173,7 @@ App::App()
     , m_debugOutputWindow(m_context)
     , m_settingsWindow(m_context)
     , m_periphConfigWindow(m_context)
-    , m_aboutWindow(m_context)
-    , m_updateOnboardingWindow(m_context)
-    , m_updateWindow(m_context) {
+    , m_aboutWindow(m_context) {
 
     // Register services
     m_context.serviceLocator.Register(m_graphicsService);
@@ -509,6 +507,7 @@ void App::RunEmulator() {
 
     auto &settings = m_settings;
 
+#if 0
     {
         const auto updatesPath = m_context.profile.GetPath(ProfilePath::PersistentState) / "updates";
 
@@ -545,6 +544,7 @@ void App::RunEmulator() {
             m_updateCheckerThread.join();
         }
     }};
+#endif
 
     // Get embedded file system
     auto embedfs = cmrc::Ymir_sdl3_rc::get_filesystem();
@@ -2555,8 +2555,6 @@ void App::RunEmulator() {
                 break;
             }
 
-            case EvtType::CheckForUpdates: CheckForUpdates(true); break;
-
             case EvtType::StateLoaded:
                 m_context.DisplayMessage(fmt::format("State {} loaded", std::get<uint32>(evt.value) + 1));
                 break;
@@ -3235,9 +3233,6 @@ void App::RunEmulator() {
                     if (ImGui::MenuItem("Open welcome window", nullptr)) {
                         OpenWelcomeModal(false);
                     }
-                    if (ImGui::MenuItem("Check for updates", nullptr)) {
-                        CheckForUpdates(true);
-                    }
 
                     ImGui::Separator();
 #if Ymir_ENABLE_IMGUI_DEMO
@@ -4066,6 +4061,7 @@ void App::ScreenshotThread() {
     }
 }
 
+#if 0
 void App::UpdateCheckerThread() {
     util::SetCurrentThreadName("Update checker thread");
 
@@ -4201,6 +4197,7 @@ void App::UpdateCheckerThread() {
         }
     }
 }
+#endif
 
 void App::OpenWelcomeModal(bool scanIPLROMs) {
     bool activeScanning = scanIPLROMs;
@@ -4360,11 +4357,6 @@ void App::OpenWelcomeModal(bool scanIPLROMs) {
     });
 }
 
-void App::CheckForUpdates(bool skipCache) {
-    m_updateCheckMode = skipCache ? UpdateCheckMode::OnlineNoCache : UpdateCheckMode::Online;
-    m_updateCheckEvent.Set();
-}
-
 void App::RebindInputs() {
     m_settings.RebindInputs();
 }
@@ -5902,10 +5894,6 @@ void App::DrawWindows() {
     m_settingsWindow.Display();
     m_periphConfigWindow.Display();
     m_aboutWindow.Display();
-#if Ymir_ENABLE_UPDATE_CHECKS
-    m_updateOnboardingWindow.Display();
-#endif
-    m_updateWindow.Display();
 }
 
 void App::OpenMemoryViewer() {
diff --git a/apps/ymir-sdl3/src/app/app.hpp b/apps/ymir-sdl3/src/app/app.hpp
index 880ba30..b3dfce7 100644
--- a/apps/ymir-sdl3/src/app/app.hpp
+++ b/apps/ymir-sdl3/src/app/app.hpp
@@ -14,8 +14,6 @@
 #include "ui/windows/peripheral_config_window.hpp"
 #include "ui/windows/settings_window.hpp"
 #include "ui/windows/system_state_window.hpp"
-#include "ui/windows/update_onboarding_window.hpp"
-#include "ui/windows/update_window.hpp"
 
 #include "ui/windows/debug/cdblock_window_set.hpp"
 #include "ui/windows/debug/debug_output_window.hpp"
@@ -89,19 +87,12 @@ private:
     std::mutex m_screenshotQueueMtx;
     bool m_screenshotThreadRunning;
 
-    std::thread m_updateCheckerThread;
-    util::Event m_updateCheckEvent;
-    UpdateCheckMode m_updateCheckMode;
-    bool m_updateCheckerThreadRunning;
-
     void RunEmulator();
 
     void EmulatorThread();
     void ScreenshotThread();
-    void UpdateCheckerThread();
 
     void OpenWelcomeModal(bool scanIPLROMS);
-    void CheckForUpdates(bool skipCache);
 
     void RebindInputs();
     void UpdateInputs(double timeDelta);
@@ -211,8 +202,6 @@ private:
     ui::SettingsWindow m_settingsWindow;
     ui::PeripheralConfigWindow m_periphConfigWindow;
     ui::AboutWindow m_aboutWindow;
-    ui::UpdateOnboardingWindow m_updateOnboardingWindow;
-    ui::UpdateWindow m_updateWindow;
 
     // -------------------------------------------------------------------------
     // Generic modal dialog
diff --git a/apps/ymir-sdl3/src/app/events/gui_event.hpp b/apps/ymir-sdl3/src/app/events/gui_event.hpp
index 69eff7b..536374e 100644
--- a/apps/ymir-sdl3/src/app/events/gui_event.hpp
+++ b/apps/ymir-sdl3/src/app/events/gui_event.hpp
@@ -82,8 +82,6 @@ struct GUIEvent {
         TryLoadCDBlockROM,
         ReloadCDBlockROM,
 
-        CheckForUpdates,
-
         TakeScreenshot,
 
         // Emulator notifications
diff --git a/apps/ymir-sdl3/src/app/events/gui_event_factory.hpp b/apps/ymir-sdl3/src/app/events/gui_event_factory.hpp
index afd4b0c..e219439 100644
--- a/apps/ymir-sdl3/src/app/events/gui_event_factory.hpp
+++ b/apps/ymir-sdl3/src/app/events/gui_event_factory.hpp
@@ -111,10 +111,6 @@ inline GUIEvent ReloadCDBlockROM() {
     return {.type = GUIEvent::Type::ReloadCDBlockROM};
 }
 
-inline GUIEvent CheckForUpdates() {
-    return {.type = GUIEvent::Type::CheckForUpdates};
-}
-
 inline GUIEvent TakeScreenshot() {
     return {.type = GUIEvent::Type::TakeScreenshot};
 }
diff --git a/apps/ymir-sdl3/src/app/settings.cpp b/apps/ymir-sdl3/src/app/settings.cpp
index cac8e2e..640fa42 100644
--- a/apps/ymir-sdl3/src/app/settings.cpp
+++ b/apps/ymir-sdl3/src/app/settings.cpp
@@ -967,9 +967,6 @@ void Settings::ResetToDefaults() {
 
     general.pauseWhenUnfocused = false;
 
-    general.checkForUpdates = false;
-    general.includeNightlyBuilds = false;
-
     gui.overrideUIScale = false;
     gui.uiScale = 1.0;
     gui.rememberWindowGeometry = true;
@@ -1161,8 +1158,6 @@ SettingsLoadResult Settings::Load(const std::filesystem::path &path) {
         Parse(tblGeneral, "AltSpeedFactor", general.altSpeedFactor);
         Parse(tblGeneral, "UseAltSpeed", general.useAltSpeed);
         Parse(tblGeneral, "PauseWhenUnfocused", general.pauseWhenUnfocused);
-        Parse(tblGeneral, "CheckForUpdates", general.checkForUpdates);
-        Parse(tblGeneral, "IncludeNightlyBuilds", general.includeNightlyBuilds);
 
         general.screenshotScale = std::clamp(general.screenshotScale, 1, 4);
 
@@ -1781,8 +1776,6 @@ SettingsSaveResult Settings::Save() {
             {"AltSpeedFactor", general.altSpeedFactor.Get()},
             {"UseAltSpeed", general.useAltSpeed.Get()},
             {"PauseWhenUnfocused", general.pauseWhenUnfocused},
-            {"CheckForUpdates", general.checkForUpdates},
-            {"IncludeNightlyBuilds", general.includeNightlyBuilds},
 
             {"PathOverrides", toml::table{{
                 {"IPLROMImages", m_context.profile.GetPathOverride(ProfilePath::IPLROMImages).native()},
diff --git a/apps/ymir-sdl3/src/app/settings.hpp b/apps/ymir-sdl3/src/app/settings.hpp
index f79aae9..d1ea0f6 100644
--- a/apps/ymir-sdl3/src/app/settings.hpp
+++ b/apps/ymir-sdl3/src/app/settings.hpp
@@ -157,8 +157,6 @@ struct Settings {
 
         bool pauseWhenUnfocused;
 
-        bool checkForUpdates;
-        bool includeNightlyBuilds;
     } general;
 
     struct GUI {
diff --git a/apps/ymir-sdl3/src/app/shared_context.hpp b/apps/ymir-sdl3/src/app/shared_context.hpp
index 2303fb1..a93d161 100644
--- a/apps/ymir-sdl3/src/app/shared_context.hpp
+++ b/apps/ymir-sdl3/src/app/shared_context.hpp
@@ -6,7 +6,6 @@
 #include <app/profile.hpp>
 #include <app/rewind_buffer.hpp>
 #include <app/rom_manager.hpp>
-#include <app/update_checker.hpp>
 
 #include <app/services/graphics_types.hpp>
 
@@ -656,8 +655,8 @@ struct SharedContext {
     int gameControllerDBCount = 0;
 
     Profile profile;
-    UpdateChecker updateChecker;
 
+#if 0
     struct Updates {
         bool inProgress = false;
         std::optional<UpdateInfo> latestStable;
@@ -669,6 +668,7 @@ struct SharedContext {
         ReleaseChannel channel;
     };
     std::optional<TargetUpdate> targetUpdate = std::nullopt;
+#endif
 
     ROMManager romManager;
     std::filesystem::path iplRomPath;
@@ -697,8 +697,6 @@ struct SharedContext {
         std::mutex messages;
         std::mutex breakpoints;
         std::mutex watchpoints;
-        std::mutex updates;
-        std::mutex targetUpdate;
     } locks;
 
     struct State {
diff --git a/apps/ymir-sdl3/src/app/ui/views/settings/general_settings_view.cpp b/apps/ymir-sdl3/src/app/ui/views/settings/general_settings_view.cpp
index 68b15bf..f669340 100644
--- a/apps/ymir-sdl3/src/app/ui/views/settings/general_settings_view.cpp
+++ b/apps/ymir-sdl3/src/app/ui/views/settings/general_settings_view.cpp
@@ -127,7 +127,7 @@ void GeneralSettingsView::Display() {
         m_context.displayScale);
 
     // -----------------------------------------------------------------------------------------------------------------
-
+#if 0
     ImGui::PushFont(m_context.fonts.sansSerif.bold, m_context.fontSizes.large);
     ImGui::SeparatorText("Updates");
     ImGui::PopFont();
@@ -193,7 +193,7 @@ void GeneralSettingsView::Display() {
             ImGui::TextUnformatted("You are already using the latest version.");
         }
     }
-
+#endif
     // -----------------------------------------------------------------------------------------------------------------
 
     ImGui::PushFont(m_context.fonts.sansSerif.bold, m_context.fontSizes.large);
diff --git a/apps/ymir-sdl3/src/app/ui/windows/about_window.cpp b/apps/ymir-sdl3/src/app/ui/windows/about_window.cpp
index 872d573..141cb3d 100644
--- a/apps/ymir-sdl3/src/app/ui/windows/about_window.cpp
+++ b/apps/ymir-sdl3/src/app/ui/windows/about_window.cpp
@@ -14,17 +14,10 @@
 
 // Includes for versions only
 #include <SDL3/SDL.h>
-#include <curl/curlver.h>
 #include <cxxopts.hpp>
 #include <fmt/format.h>
 #include <lz4.h>
-#include <nghttp2/nghttp2ver.h>
-#include <nghttp3/version.h>
-#include <ngtcp2/version.h>
-#include <nlohmann/json.hpp>
-#include <openssl/opensslv.h>
 #include <RtMidi.h>
-#include <semver.hpp>
 #include <toml++/toml.hpp>
 #include <xxhash.h>
 
@@ -35,16 +28,12 @@
 #define BROTLI_VERSION "1.1.0" // Not exported
 #define CEREAL_VERSION "1.3.2" // Not exported
 #define CMRC_VERSION "2.0.0"   // Not exported
-#define CURL_VERSION _SEMVER_STR(LIBCURL_VERSION_MAJOR, LIBCURL_VERSION_MINOR, LIBCURL_VERSION_PATCH)
 #define CXXOPTS_VERSION _SEMVER_STR(CXXOPTS__VERSION_MAJOR, CXXOPTS__VERSION_MINOR, CXXOPTS__VERSION_PATCH)
 #define DATE_VERSION "3.0.4" // Not exported
 #define IMGUI_VERSION_FULL IMGUI_VERSION " (" _STR(IMGUI_VERSION_NUM) ")"
 #define LZMA_VERSION "24.05" // Private dependency of libchdr
 #define MIO_VERSION "1.1.0"  // Not exported
-#define NLOHMANN_JSON_VERSION \
-    _SEMVER_STR(NLOHMANN_JSON_VERSION_MAJOR, NLOHMANN_JSON_VERSION_MINOR, NLOHMANN_JSON_VERSION_PATCH)
 #define SDL_VERSION_STR _SEMVER_STR(SDL_MAJOR_VERSION, SDL_MINOR_VERSION, SDL_MICRO_VERSION)
-#define SEMVER_VERSION _SEMVER_STR(SEMVER_VERSION_MAJOR, SEMVER_VERSION_MINOR, SEMVER_VERSION_PATCH)
 #define STB_IMAGE_VERSION "2.30"       // Not exported
 #define STB_IMAGE_WRITE_VERSION "1.16" // Not exported
 #define MC_CONCQUEUE_VERSION "1.0.4"   // Not exported
@@ -83,7 +72,6 @@ inline constexpr License licenseBSD3        {.name = "BSD-3-Clause",  .url = "ht
 //inline constexpr License licenseBSL         {.name = "BSL-1.0", .      url = "https://opensource.org/license/bsl-1-0"};
 //inline constexpr License licenseISC         {.name = "ISC",           .url = "https://opensource.org/licenses/ISC"};
 inline constexpr License licenseMIT         {.name = "MIT",           .url = "https://opensource.org/licenses/MIT"};
-inline constexpr License licenseMITCurl     {.name = "MIT-cURL",      .url = "https://github.com/curl/curl/blob/master/COPYING"};
 inline constexpr License licenseMITRtMidi   {.name = "MIT-RtMidi",    .url = "https://github.com/thestk/rtmidi/blob/master/LICENSE"};
 inline constexpr License licensePublicDomain{.name = "Public domain", .url = nullptr};
 //inline constexpr License licenseUnlicense   {.name = "Unlicense",     .url = "https://opensource.org/licenses/unlicense"};
@@ -102,7 +90,6 @@ static const struct {
     {.name = "Brotli",                        .version = BROTLI_VERSION,             .license = licenseMIT,           .repoURL = "https://github.com/google/brotli",               .licenseURL = "https://github.com/google/brotli/blob/master/LICENSE"},
     {.name = "cereal",                        .version = CEREAL_VERSION,             .license = licenseBSD3,          .repoURL = "https://github.com/USCiLab/cereal",              .licenseURL = "https://github.com/USCiLab/cereal/blob/master/LICENSE",                  .homeURL = "https://uscilab.github.io/cereal/index.html"},
     {.name = "CMakeRC",                       .version = CMRC_VERSION,               .license = licenseMIT,           .repoURL = "https://github.com/vector-of-bool/cmrc",         .licenseURL = "https://github.com/vector-of-bool/cmrc/blob/master/LICENSE.txt"},
-    {.name = "curl",                          .version = CURL_VERSION,               .license = licenseMITCurl,       .repoURL = "https://github.com/curl/curl",                   .licenseURL = "https://github.com/curl/curl/blob/master/COPYING",                       .homeURL = "https://curl.se/"},
     {.name = "cxxopts",                       .version = CXXOPTS_VERSION,            .license = licenseMIT,           .repoURL = "https://github.com/jarro2783/cxxopts",           .licenseURL = "https://github.com/jarro2783/cxxopts/blob/master/LICENSE"},
     {.name = "date",                          .version = DATE_VERSION,               .license = licenseMIT,           .repoURL = "https://github.com/HowardHinnant/date",          .licenseURL = "https://github.com/HowardHinnant/date/blob/master/LICENSE.txt"},
     {.name = "Dear ImGui",                    .version = IMGUI_VERSION_FULL,         .license = licenseMIT,           .repoURL = "https://github.com/ocornut/imgui",               .licenseURL = "https://github.com/ocornut/imgui/blob/master/LICENSE.txt"},
@@ -113,12 +100,6 @@ static const struct {
     {.name = "lzma",                          .version = LZMA_VERSION,               .license = licensePublicDomain,                                                                                                                                                       .homeURL = "https://www.7-zip.org/sdk.html",},
     {.name = "mio",                           .version = MIO_VERSION,                .license = licenseMIT,           .repoURL = "https://github.com/StrikerX3/mio",               .licenseURL = "https://github.com/StrikerX3/mio/blob/master/LICENSE"},
     {.name = "moodycamel::\nConcurrentQueue", .version = "\n" MC_CONCQUEUE_VERSION,  .license = licenseBSD2,          .repoURL = "https://github.com/cameron314/concurrentqueue",  .licenseURL = "https://github.com/cameron314/concurrentqueue/blob/master/LICENSE.md"},
-    {.name = "Neargye/semver",                .version = SEMVER_VERSION,             .license = licenseMIT,           .repoURL = "https://github.com/Neargye/semver",              .licenseURL = "https://github.com/Neargye/semver/blob/master/LICENSE"},
-    {.name = "nghttp2",                       .version = NGHTTP2_VERSION,            .license = licenseMIT,           .repoURL = "https://github.com/nghttp2/nghttp2",             .licenseURL = "https://github.com/nghttp2/nghttp2/blob/master/COPYING",                 .homeURL = "https://nghttp2.org/"},
-    {.name = "nghttp3",                       .version = NGHTTP3_VERSION,            .license = licenseMIT,           .repoURL = "https://github.com/ngtcp2/nghttp3",              .licenseURL = "https://github.com/ngtcp2/nghttp3/blob/main/COPYING",                    .homeURL = "https://nghttp2.org/nghttp3/"},
-    {.name = "ngtcp2",                        .version = NGTCP2_VERSION,             .license = licenseMIT,           .repoURL = "https://github.com/ngtcp2/ngtcp2",               .licenseURL = "https://github.com/ngtcp2/ngtcp2/blob/main/COPYING",                     .homeURL = "https://nghttp2.org/ngtcp2/"},
-    {.name = "nlohmann/json",                 .version = NLOHMANN_JSON_VERSION,      .license = licenseMIT,           .repoURL = "https://github.com/nlohmann/json",               .licenseURL = "https://github.com/nlohmann/json/blob/develop/LICENSE.MIT",              .homeURL = "https://json.nlohmann.me/"},
-    {.name = "OpenSSL",                       .version = OPENSSL_FULL_VERSION_STR,   .license = licenseApache2_0,     .repoURL = "https://github.com/openssl/openssl",             .licenseURL = "https://github.com/openssl/openssl/blob/master/LICENSE.txt",             .homeURL = "https://www.openssl.org/"},
     {.name = "RtMidi",                        .version = RTMIDI_VERSION,             .license = licenseMITRtMidi,     .repoURL = "https://github.com/thestk/rtmidi",               .licenseURL = "https://github.com/thestk/rtmidi/blob/master/LICENSE"},
     {.name = "SDL3",                          .version = SDL_VERSION_STR,            .license = licenseZlib,          .repoURL = "https://github.com/libsdl-org/SDL",              .licenseURL = "https://github.com/libsdl-org/SDL/blob/main/LICENSE.txt"},
     {.name = "SDL_GameControllerDB",                                                 .license = licenseZlib,          .repoURL = "https://github.com/mdqinc/SDL_GameControllerDB", .licenseURL = "https://github.com/mdqinc/SDL_GameControllerDB/blob/master/LICENSE"},
-- 
2.53.0

