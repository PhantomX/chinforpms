From ab5de4d573d1ada1e26524e0551190e005038540 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Fri, 4 Oct 2019 20:03:19 -0300
Subject: [PATCH] fix async patch

---
 dxvk-async.patch | 24 +++++++++++++++++++-----
 1 file changed, 19 insertions(+), 5 deletions(-)

diff --git a/dxvk-async.patch b/dxvk-async.patch
index ec1998b..670bb93 100644
--- a/dxvk-async.patch
+++ b/dxvk-async.patch
@@ -79,13 +79,10 @@ index b4f679fa..13c86d8f 100644
  
      if (!m_flags.test(DxvkContextFlag::GpRenderPassBound))
        this->startRenderPass();
-@@ -4465,4 +4470,13 @@ namespace dxvk {
+@@ -4465,6 +4470,14 @@ namespace dxvk {
      }
    }
    
--}
-\ No newline at end of file
-+
 +  bool DxvkContext::checkAsyncCompilationCompat() {
 +    bool fbCompat = true;
 +    for (uint32_t i = 0; fbCompat && i < m_state.om.framebuffer->numAttachments(); i++) {
@@ -94,6 +91,17 @@ index b4f679fa..13c86d8f 100644
 +    }
 +    return fbCompat;
 +  }
+ 
+   DxvkGraphicsPipeline* DxvkContext::lookupGraphicsPipeline(
+     const DxvkGraphicsPipelineShaders&  shaders) {
+@@ -4486,5 +4499,5 @@ namespace dxvk {
+ 
+     return m_cpLookupCache[idx];
+   }
+-  
+-}
+\ No newline at end of file
++
 +}
 diff --git a/src/dxvk/dxvk_context.h b/src/dxvk/dxvk_context.h
 index f54f5321..0984d085 100644
@@ -108,11 +116,17 @@ index f54f5321..0984d085 100644
      
      void updateIndexBufferBinding();
      void updateVertexBufferBindings();
-@@ -1180,6 +1180,7 @@ namespace dxvk {
+@@ -1183,6 +1183,8 @@ namespace dxvk {
  
      void trackDrawBuffer();
  
 +    bool checkAsyncCompilationCompat();
++
+     DxvkGraphicsPipeline* lookupGraphicsPipeline(
+       const DxvkGraphicsPipelineShaders&  shaders);
+ 
+@@ -1191,4 +1193,4 @@ namespace dxvk {
+ 
    };
    
 -}
-- 
2.23.0

