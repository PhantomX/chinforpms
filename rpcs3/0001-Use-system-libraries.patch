From beee229a7aed36feff93a0175234b24c2ef950e8 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Wed, 9 Feb 2022 16:11:12 -0300
Subject: [PATCH] Use system libraries

---
 3rdparty/CMakeLists.txt | 26 ++++++++++++++++++++++++--
 1 file changed, 24 insertions(+), 2 deletions(-)

diff --git a/3rdparty/CMakeLists.txt b/3rdparty/CMakeLists.txt
index 3d84d3f..15f8da4 100644
--- a/3rdparty/CMakeLists.txt
+++ b/3rdparty/CMakeLists.txt
@@ -73,7 +73,16 @@ endif()
 
 
 # hidapi
-add_subdirectory(hidapi)
+find_package(hidapi)
+if(hidapi_FOUND)
+	message(STATUS "Using the system hidapi")
+	add_library(hidapi INTERFACE)
+	target_include_directories(hidapi SYSTEM INTERFACE ${HIDAPI_INCLUDEDIR})
+	target_link_libraries(hidapi INTERFACE hidapi::hidraw)
+	set(USE_SYSTEM_HIDAPI ON)
+else()
+	add_subdirectory(hidapi)
+endif()
 
 
 # Vulkan
@@ -134,7 +143,15 @@ target_include_directories(3rdparty_stblib INTERFACE stblib/include)
 add_subdirectory(discord-rpc)
 
 # Cubeb
-add_subdirectory(cubeb EXCLUDE_FROM_ALL)
+find_package(cubeb)
+if(cubeb_FOUND)
+	message(STATUS "Using the system cubeb")
+	add_library(cubeb INTERFACE)
+	target_link_libraries(cubeb INTERFACE cubeb::cubeb)
+	add_library(3rdparty::cubeb ALIAS cubeb)
+else()
+	add_subdirectory(cubeb EXCLUDE_FROM_ALL)
+endif()
 
 # SoundTouch
 add_subdirectory(SoundTouch EXCLUDE_FROM_ALL)
@@ -235,6 +252,7 @@ if(USE_FAUDIO)
 			find_package(FAudio REQUIRED CONFIGS FAudioConfig.cmake FAudio-config.cmake)
 			add_library(3rdparty_FAudio INTERFACE)
 			target_link_libraries(3rdparty_FAudio INTERFACE FAudio)
+			target_include_directories(3rdparty_FAudio SYSTEM INTERFACE ${FAUDIO_INCLUDEDIR})
 			target_compile_definitions(3rdparty_FAudio INTERFACE -DHAVE_FAUDIO)
 			set(FAUDIO_TARGET 3rdparty_FAudio)
 		else()
@@ -341,7 +359,11 @@ add_library(3rdparty::flatbuffers ALIAS 3rdparty_flatbuffers)
 add_library(3rdparty::pugixml ALIAS pugixml)
 add_library(3rdparty::yaml-cpp ALIAS yaml-cpp)
 add_library(3rdparty::xxhash ALIAS xxhash)
+if(USE_SYSTEM_HIDAPI)
+add_library(3rdparty::hidapi ALIAS hidapi)
+else()
 add_library(3rdparty::hidapi ALIAS 3rdparty_hidapi)
+endif()
 add_library(3rdparty::libpng ALIAS ${LIBPNG_TARGET})
 add_library(3rdparty::opengl ALIAS 3rdparty_opengl)
 add_library(3rdparty::stblib ALIAS 3rdparty_stblib)
-- 
2.37.1

