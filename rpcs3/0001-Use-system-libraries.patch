From f136c4c777b8d562d16eb77bb052c0540c67030f Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Wed, 9 Feb 2022 16:11:12 -0300
Subject: [PATCH] Use system libraries

---
 3rdparty/CMakeLists.txt                  | 9 +++++++++
 3rdparty/feralinteractive/CMakeLists.txt | 7 +++++++
 2 files changed, 16 insertions(+)

diff --git a/3rdparty/CMakeLists.txt b/3rdparty/CMakeLists.txt
index 4630774..c56561f 100644
--- a/3rdparty/CMakeLists.txt
+++ b/3rdparty/CMakeLists.txt
@@ -102,7 +102,15 @@ add_subdirectory(hidapi)
 add_subdirectory(glslang EXCLUDE_FROM_ALL)
 
 # yaml-cpp
+find_package(yaml-cpp)
+if(yaml-cpp_FOUND)
+	message(STATUS "Using the system yaml-cpp")
+	add_library(yaml-cpp_shared INTERFACE)
+	target_link_libraries(yaml-cpp_shared INTERFACE yaml-cpp)
+	add_library(3rdparty::yaml-cpp ALIAS yaml-cpp_shared)
+else()
 add_subdirectory(yaml-cpp)
+endif()
 
 
 # OpenGL
@@ -261,6 +269,7 @@ if(USE_FAUDIO)
 			message(STATUS "RPCS3: Using system FAudio")
 			find_package(FAudio REQUIRED CONFIGS FAudioConfig.cmake FAudio-config.cmake)
 			add_library(3rdparty_FAudio INTERFACE)
+			add_library(FAudio ALIAS FAudio::FAudio-shared)
 			target_link_libraries(3rdparty_FAudio INTERFACE FAudio)
 			target_compile_definitions(3rdparty_FAudio INTERFACE -DHAVE_FAUDIO)
 			set(FAUDIO_TARGET 3rdparty_FAudio)
diff --git a/3rdparty/feralinteractive/CMakeLists.txt b/3rdparty/feralinteractive/CMakeLists.txt
index c7b136e..4adc376 100644
--- a/3rdparty/feralinteractive/CMakeLists.txt
+++ b/3rdparty/feralinteractive/CMakeLists.txt
@@ -3,7 +3,14 @@
 add_library(3rdparty_feralinteractive INTERFACE)
 
 if (CMAKE_SYSTEM MATCHES "Linux")
+pkg_check_modules(gamemode IMPORTED_TARGET gamemode)
+if(gamemode_FOUND)
+	message(STATUS "Using the system gamemode")
+	add_library(feralinteractive INTERFACE)
+	target_link_libraries(feralinteractive INTERFACE PkgConfig::gamemode)
+else()
 	target_include_directories(3rdparty_feralinteractive INTERFACE feralinteractive/lib)
+endif()
 	target_compile_definitions(3rdparty_feralinteractive INTERFACE -DGAMEMODE_AVAILABLE)
 	target_link_libraries(3rdparty_feralinteractive INTERFACE feralinteractive)
 endif()
-- 
2.50.1

