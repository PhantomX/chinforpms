From 65ced4a4b4fb48485f614bcbcec5052cd10f0016 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Tue, 3 Jan 2023 18:40:09 -0300
Subject: [PATCH] Set datadir to RPM packaging

---
 pcsx2-qt/Translations.cpp | 15 +++++++--------
 pcsx2/Pcsx2Config.cpp     |  2 +-
 2 files changed, 8 insertions(+), 9 deletions(-)

diff --git a/pcsx2-qt/Translations.cpp b/pcsx2-qt/Translations.cpp
index f1a9165..e34c59c 100644
--- a/pcsx2-qt/Translations.cpp
+++ b/pcsx2-qt/Translations.cpp
@@ -72,7 +72,6 @@ static QString getSystemLanguage()
 {
 	std::vector<std::pair<QString, QString>> available = QtHost::GetAvailableLanguageList();
 	QString locale = QLocale::system().name();
-	locale.replace('_', '-');
 	// Can we find an exact match?
 	for (const std::pair<QString, QString>& entry : available)
 	{
@@ -81,11 +80,11 @@ static QString getSystemLanguage()
 	}
 	// How about a partial match?
 	QStringView lang = QStringView(locale);
-	lang = lang.left(lang.indexOf('-'));
+	lang = lang.left(lang.indexOf('_'));
 	for (const std::pair<QString, QString>& entry : available)
 	{
 		QStringView avail = QStringView(entry.second);
-		avail = avail.left(avail.indexOf('-'));
+		avail = avail.left(avail.indexOf('_'));
 		if (avail == lang)
 		{
 			Console.Warning("Couldn't find translation for system language %s, using %s instead",
@@ -123,20 +122,20 @@ void QtHost::InstallTranslator(QWidget* dialog_parent)
 #elif defined(PCSX2_APP_DATADIR)
 	const QString base_dir = QStringLiteral("%1/%2/translations").arg(qApp->applicationDirPath()).arg(PCSX2_APP_DATADIR);
 #else
-	const QString base_dir = QStringLiteral("%1/translations").arg(qApp->applicationDirPath());
+	const QString base_dir = QStringLiteral("_RPM_DATADIR_/translations");
 #endif
 
 	// Qt base uses underscores instead of hyphens.
 	const QString qt_language = QString(language).replace(QChar('-'), QChar('_'));
-	QString base_path = QStringLiteral("%1/qt_%2.qm").arg(base_dir).arg(qt_language);
+	QString base_path = QStringLiteral("_RPM_QTTDIR_/qt_%1.qm").arg(qt_language);
 	bool has_base_ts = QFile::exists(base_path);
 	if (!has_base_ts)
 	{
 		// Try without the country suffix.
-		const qsizetype index = language.lastIndexOf('-');
+		const qsizetype index = language.lastIndexOf('_');
 		if (index > 0)
 		{
-			base_path = QStringLiteral("%1/qt_%2.qm").arg(base_dir).arg(language.left(index));
+			base_path = QStringLiteral("_RPM_QTTDIR_/qt_%1.qm").arg(qt_language.left(index));
 			has_base_ts = QFile::exists(base_path);
 		}
 	}
@@ -157,7 +156,7 @@ void QtHost::InstallTranslator(QWidget* dialog_parent)
 		}
 	}
 
-	const QString path = QStringLiteral("%1/pcsx2-qt_%3.qm").arg(base_dir).arg(language);
+	const QString path = QStringLiteral("%1/pcsx2-qt_%3.qm").arg(base_dir).arg(qt_language);
 	QTranslator* translator = nullptr;
 	if (QFile::exists(path))
 	{
diff --git a/pcsx2/Pcsx2Config.cpp b/pcsx2/Pcsx2Config.cpp
index 154b34b..61f3135 100644
--- a/pcsx2/Pcsx2Config.cpp
+++ b/pcsx2/Pcsx2Config.cpp
@@ -2133,7 +2133,7 @@ bool EmuFolders::SetResourcesDirectory()
 #ifndef __APPLE__
 #ifndef PCSX2_APP_DATADIR
 	// On Windows/Linux, these are in the binary directory.
-	Resources = Path::Combine(AppRoot, "resources");
+	Resources = "_RPM_DATADIR_/resources";
 #else
 	Resources = Path::Canonicalize(Path::Combine(AppRoot, PCSX2_APP_DATADIR "/resources"));
 #endif
-- 
2.51.1

