From 8414f5baf4c2bb0dee1e74fabaaa61042192a2aa Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Sat, 14 Mar 2020 18:06:23 -0300
Subject: [PATCH] preload: fix for multilib

---
 bin/mangohud.in | 5 ++---
 src/meson.build | 4 ++--
 2 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/bin/mangohud.in b/bin/mangohud.in
index 0d4f5cd..3ab6df5 100755
--- a/bin/mangohud.in
+++ b/bin/mangohud.in
@@ -15,7 +15,6 @@ fi
 
 # Execute the program under a clean environment
 # pass through the overriden LD_PRELOAD environment variables
-LD_PRELOAD="${LD_PRELOAD}:${MANGOHUD_LIB_NAME}"
-LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:@libdir_mangohud@"
+LD_PRELOAD="${LD_PRELOAD}:/usr/\$LIB/mangohud/${MANGOHUD_LIB_NAME}"
 
-exec env MANGOHUD=1 LD_LIBRARY_PATH="${LD_LIBRARY_PATH}" LD_PRELOAD="${LD_PRELOAD}" "$@"
+exec env MANGOHUD=1 LD_PRELOAD="${LD_PRELOAD}" "$@"
diff --git a/src/meson.build b/src/meson.build
index 3c187d6..31f7dde 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -110,7 +110,7 @@ else
 endif
 
 configure_file(input : '../bin/mangohud.in',
-  output : 'mangohud@0@'.format(mangohud_cpu_family),
+  output : 'mangohud',
   configuration : {'libdir_mangohud' : libdir_mangohud},
   install_dir : get_option('bindir'),
 )
@@ -119,4 +119,4 @@ install_data(
   files('../bin/MangoHud.conf'),
   install_dir : join_paths(get_option('datadir'), 'doc', 'mangohud'),
   rename : ['MangoHud.conf.example']
-)
\ No newline at end of file
+)
-- 
2.24.1

