From 0d850b343266668ebc7ec16b609f5414ec974466 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Tue, 20 Apr 2021 15:47:25 -0300
Subject: [PATCH] rpm build fixes

---
 DiscImageCreator/get.cpp  | 2 +-
 DiscImageCreator/makefile | 8 ++++----
 DiscImageCreator/xml.h    | 2 +-
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/DiscImageCreator/get.cpp b/DiscImageCreator/get.cpp
index 0ec65c6..5993a68 100644
--- a/DiscImageCreator/get.cpp
+++ b/DiscImageCreator/get.cpp
@@ -462,7 +462,7 @@ BOOL GetEccEdcCmd(
 #ifdef _WIN32
 	BOOL bRet = GetCmd(szPathForEcc, _T("EccEdc"), _T("exe"));
 #else
-	BOOL bRet = GetCmd(szPathForEcc, _T("./EccEdc_linux"), _T(".out"));
+	BOOL bRet = GetCmd(szPathForEcc, _T("_RPM_BIN_DIR_/EccEdc"), _T(".out"));
 #endif
 	if (bRet && PathFileExists(szPathForEcc)) {
 		if (!_tcscmp(pszCmd, _T("check"))) {
diff --git a/DiscImageCreator/makefile b/DiscImageCreator/makefile
index 2de8e96..ef5735e 100644
--- a/DiscImageCreator/makefile
+++ b/DiscImageCreator/makefile
@@ -1,7 +1,8 @@
 TARGET := DiscImageCreator
 INCFLAGS := -I. -I_external -I_linux
-CFLAGS := -include _linux/defineForLinux.h
+CFLAGS += -include _linux/defineForLinux.h
 CXXFLAGS := $(CFLAGS) -std=c++11
+LIBS := -ltinyxml2
 
 ifneq ($(SANITIZER),)
    CFLAGS   := -fsanitize=$(SANITIZER) $(CFLAGS)
@@ -13,8 +14,8 @@ ifeq ($(DEBUG), 1)
 	CFLAGS += -O0 -g
 	CXXFLAGS += -O0 -g
 else
-	CFLAGS += -O2 -Wall -Wextra -Wno-unknown-pragmas
-	CXXFLAGS += -O2 -Wall -Wextra -Wno-unknown-pragmas -Waggregate-return -Wcast-align -Wcast-qual -Wconditionally-supported -Wdisabled-optimization -Wdouble-promotion -Wfloat-equal -Wformat=2 -Wformat-signedness -Winit-self -Winline -Winvalid-pch -Wlogical-op -Wmissing-include-dirs -Wmultichar -Wnoexcept -Woverlength-strings -Wpacked -Wpointer-arith -Wredundant-decls -Wshadow -Wstack-protector -Wstrict-aliasing=2 -Wstrict-null-sentinel -Wswitch-default -Wswitch-enum -Wtrampolines -Wvariadic-macros -Wvector-operation-performance -Wwrite-strings -Wunused-macros
+	CFLAGS += -O2 -fPIC -Wall -Wextra -Wno-unknown-pragmas
+	CXXFLAGS += -O2 -fPIC -Wall -Wextra -Wno-unknown-pragmas -Waggregate-return -Wcast-align -Wcast-qual -Wconditionally-supported -Wdisabled-optimization -Wdouble-promotion -Wfloat-equal -Wformat=2 -Wformat-signedness -Winit-self -Winline -Winvalid-pch -Wlogical-op -Wmissing-include-dirs -Wmultichar -Wnoexcept -Woverlength-strings -Wpacked -Wpointer-arith -Wredundant-decls -Wshadow -Wstack-protector -Wstrict-aliasing=2 -Wstrict-null-sentinel -Wswitch-default -Wswitch-enum -Wtrampolines -Wvariadic-macros -Wvector-operation-performance -Wwrite-strings -Wunused-macros
 endif
 
 SOURCES_CXX := \
@@ -50,7 +51,6 @@ SOURCES_CXX := \
   _external/platform_util.o \
   _external/prngcd.o \
   _external/rijndael-alg-fst.o \
-  _external/tinyxml2.o \
   _external/sha1.o \
   _external/sha224-256.o \
   _external/sha384-512.o \
diff --git a/DiscImageCreator/xml.h b/DiscImageCreator/xml.h
index f92b77f..52909d3 100644
--- a/DiscImageCreator/xml.h
+++ b/DiscImageCreator/xml.h
@@ -15,7 +15,7 @@
  */
 #pragma once
 #ifndef _WIN32
-#include "_external/tinyxml2.h"
+#include <tinyxml2.h>
 using namespace tinyxml2;
 #endif
 
-- 
2.39.2

