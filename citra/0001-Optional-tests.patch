From faefff2879f98f9d3a68d0e8e498ca053c50ac98 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Sun, 13 Nov 2022 09:55:54 -0300
Subject: [PATCH] Optional tests

---
 CMakeLists.txt           | 2 ++
 externals/CMakeLists.txt | 2 ++
 src/CMakeLists.txt       | 3 +++
 3 files changed, 7 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 518fe00..7327d9d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -61,6 +61,8 @@ CMAKE_DEPENDENT_OPTION(CITRA_BUNDLE_LIBRARIES "Bundle dependent libraries with t
 
 option(CITRA_WARNINGS_AS_ERRORS "Enable warnings as errors" ON)
 
+option(CITRA_TESTS "Compile tests" ON)
+
 if (CITRA_USE_PRECOMPILED_HEADERS)
     if (MSVC AND CCACHE)
         # buildcache does not properly cache PCH files, leading to compilation errors.
diff --git a/externals/CMakeLists.txt b/externals/CMakeLists.txt
index b57732d..e5fe8e8 100644
--- a/externals/CMakeLists.txt
+++ b/externals/CMakeLists.txt
@@ -33,6 +33,7 @@ target_link_libraries(boost_iostreams PUBLIC boost)
 # Add additional boost libs here; remember to ALIAS them in the root CMakeLists!
 endif()
 
+if (CITRA_TESTS)
 # Catch2
 find_package(Catch2 3.1.0 REQUIRED CONFIG)
 if(Catch2_FOUND)
@@ -45,6 +46,7 @@ set(CATCH_INSTALL_DOCS OFF)
 set(CATCH_INSTALL_EXTRAS OFF)
 add_subdirectory(catch2)
 endif()
+endif()
 
 # Crypto++
 set(CRYPTOPP_BUILD_DOCUMENTATION OFF)
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 7b096d1..23ba201 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -154,7 +154,10 @@ add_subdirectory(video_core)
 add_subdirectory(audio_core)
 add_subdirectory(network)
 add_subdirectory(input_common)
+
+if (CITRA_TESTS)
 add_subdirectory(tests)
+endif()
 
 if (ENABLE_SDL2)
     add_subdirectory(citra)
-- 
2.40.1

