From 3a0f1cb4fa686079bcb5f797e9a34b6fa7c4d140 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Sun, 13 Nov 2022 09:55:54 -0300
Subject: [PATCH] Optional tests

---
 CMakeLists.txt           | 2 ++
 externals/CMakeLists.txt | 2 ++
 src/CMakeLists.txt       | 3 +++
 3 files changed, 7 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index a54cb66..8ee21d5 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -51,6 +51,8 @@ option(USE_SYSTEM_BOOST "Use the system Boost libs (instead of the bundled ones)
 
 CMAKE_DEPENDENT_OPTION(ENABLE_FDK "Use FDK AAC decoder" OFF "NOT ENABLE_FFMPEG_AUDIO_DECODER;NOT ENABLE_MF" OFF)
 
+option(CITRA_TESTS "Compile tests" ON)
+
 if (CITRA_USE_PRECOMPILED_HEADERS)
     if (MSVC AND CCACHE)
         # buildcache does not properly cache PCH files, leading to compilation errors.
diff --git a/externals/CMakeLists.txt b/externals/CMakeLists.txt
index 8fa154b..d3b0729 100644
--- a/externals/CMakeLists.txt
+++ b/externals/CMakeLists.txt
@@ -24,6 +24,7 @@ target_link_libraries(boost_serialization PUBLIC boost)
 # Add additional boost libs here; remember to ALIAS them in the root CMakeLists!
 endif()
 
+if (CITRA_TESTS)
 # Catch2
 find_package(Catch2 3.1.0 REQUIRED CONFIG)
 if(Catch2_FOUND)
@@ -36,6 +37,7 @@ set(CATCH_INSTALL_DOCS OFF)
 set(CATCH_INSTALL_EXTRAS OFF)
 add_subdirectory(catch2)
 endif()
+endif()
 
 # Crypto++
 set(CRYPTOPP_BUILD_DOCUMENTATION OFF)
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index f59607d..21a390e 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -148,7 +148,10 @@ add_subdirectory(video_core)
 add_subdirectory(audio_core)
 add_subdirectory(network)
 add_subdirectory(input_common)
+
+if (CITRA_TESTS)
 add_subdirectory(tests)
+endif()
 
 if (ENABLE_SDL2)
     add_subdirectory(citra)
-- 
2.39.1

