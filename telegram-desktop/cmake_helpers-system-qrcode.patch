From fee202d3b1f86a2a1d63c8f7eb828deb439a3d85 Mon Sep 17 00:00:00 2001
From: Vitaly Zaitsev <vitaly@easycoding.org>
Date: Thu, 9 Jan 2020 14:44:11 +0100
Subject: [PATCH 3/4] Use packaged version of qr-code-generator library.

---
 external/qr_code_generator/CMakeLists.txt | 41 +++++++++++++----------
 1 file changed, 24 insertions(+), 17 deletions(-)

diff --git a/external/qr_code_generator/CMakeLists.txt b/external/qr_code_generator/CMakeLists.txt
index 0f81125..606d8a5 100644
--- a/external/qr_code_generator/CMakeLists.txt
+++ b/external/qr_code_generator/CMakeLists.txt
@@ -4,24 +4,31 @@
 # For license and copyright information please follow this link:
 # https://github.com/desktop-app/legal/blob/master/LEGAL
 
-add_library(external_qr_code_generator OBJECT)
+add_library(external_qr_code_generator INTERFACE IMPORTED GLOBAL)
 add_library(desktop-app::external_qr_code_generator ALIAS external_qr_code_generator)
-init_target(external_qr_code_generator "(external)")
 
-set(qr_loc ${third_party_loc}/QR)
-set(qr_src ${qr_loc}/cpp)
+if (DESKTOP_APP_USE_PACKAGED)
+    find_library(QRCODE_LIBRARY NAMES "qrcodegencpp")
+    target_include_directories(external_qr_code_generator INTERFACE "${INCLUDE_INSTALL_DIR}/qrcodegencpp")
+    target_link_libraries(external_qr_code_generator INTERFACE ${QRCODE_LIBRARY})
+else()
+    init_target(external_qr_code_generator "(external)")
 
-nice_target_sources(external_qr_code_generator ${qr_src}
-PRIVATE
-    BitBuffer.cpp
-    BitBuffer.hpp
-    QrCode.cpp
-    QrCode.hpp
-    QrSegment.cpp
-    QrSegment.hpp
-)
+    set(qr_loc ${third_party_loc}/QR)
+    set(qr_src ${qr_loc}/cpp)
 
-target_include_directories(external_qr_code_generator
-PUBLIC
-    ${qr_src}
-)
+    nice_target_sources(external_qr_code_generator ${qr_src}
+    PRIVATE
+        BitBuffer.cpp
+        BitBuffer.hpp
+        QrCode.cpp
+        QrCode.hpp
+        QrSegment.cpp
+        QrSegment.hpp
+    )
+
+    target_include_directories(external_qr_code_generator
+    PUBLIC
+        ${qr_src}
+    )
+endif()
-- 
2.24.1

