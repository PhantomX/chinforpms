From 1ebc5413f0dbfdaf01db4f44154108949c2cf63c Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Wed, 12 Jun 2019 22:45:08 -0300
Subject: [PATCH] Unset QT scale env vars

https://bugs.archlinux.org/task/62594
---
 Telegram/SourceFiles/core/launcher.cpp | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/Telegram/SourceFiles/core/launcher.cpp b/Telegram/SourceFiles/core/launcher.cpp
index 79f7b75..1f54f57 100644
--- a/Telegram/SourceFiles/core/launcher.cpp
+++ b/Telegram/SourceFiles/core/launcher.cpp
@@ -249,9 +249,6 @@ void Launcher::init() {
 #elif defined(Q_OS_LINUX) && QT_VERSION >= QT_VERSION_CHECK(5, 7, 0)
 	QApplication::setDesktopFileName(qsl("telegramdesktop.desktop"));
 #endif
-#ifndef OS_MAC_OLD
-	QApplication::setAttribute(Qt::AA_DisableHighDpiScaling, true);
-#endif // OS_MAC_OLD
 
 	initHook();
 }
@@ -270,6 +267,13 @@ int Launcher::exec() {
 	Platform::start(); // must be started before Sandbox is created
 
 	unsetenv("QT_QPA_PLATFORMTHEME");
+
+	// unset QT screen scale related envvars
+	unsetenv("QT_SCREEN_SCALE_FACTORS");
+	unsetenv("QT_AUTO_SCREEN_SCALE_FACTOR");
+	unsetenv("QT_SCALE_FACTOR");
+	unsetenv("QT_DEVICE_PIXEL_RATIO");
+
 	auto result = executeApplication();
 
 	DEBUG_LOG(("Telegram finished, result: %1").arg(result));
-- 
2.21.0

