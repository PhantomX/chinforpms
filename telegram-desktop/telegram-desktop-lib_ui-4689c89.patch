From 4689c896e201cc2863d629eac58306a0b561a71c Mon Sep 17 00:00:00 2001
From: Ilya Fedin <fedin-ilja2010@ya.ru>
Date: Fri, 5 Aug 2022 14:45:42 +0400
Subject: [PATCH] Fix packaged build

---
 Telegram/lib_ui/ui/platform/linux/ui_linux_wayland_integration.cpp | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/Telegram/lib_ui/ui/platform/linux/ui_linux_wayland_integration.cpp b/Telegram/lib_ui/ui/platform/linux/ui_linux_wayland_integration.cpp
index bcbfa53d..1de34fdc 100644
--- a/Telegram/lib_ui/ui/platform/linux/ui_linux_wayland_integration.cpp
+++ b/Telegram/lib_ui/ui/platform/linux/ui_linux_wayland_integration.cpp
@@ -12,6 +12,11 @@ For license and copyright information please follow this link:
 #include "waylandshells/xdg_shell.h"
 #include "qwayland-xdg-shell.h"
 
+// must be before QtPlugin include
+#ifndef QT_STATICPLUGIN
+#define QT_STATICPLUGIN
+#endif // !QT_STATICPLUGIN
+
 #include <QtCore/QtPlugin>
 #include <QtGui/QGuiApplication>
 #include <QtGui/QWindow>
@@ -24,10 +29,6 @@ For license and copyright information please follow this link:
 #define slots Q_SLOTS
 #endif // QT_NO_KEYWORDS
 
-#ifndef QT_STATICPLUGIN
-#define QT_STATICPLUGIN
-#endif // !QT_STATICPLUGIN
-
 #include <private/qwaylanddisplay_p.h>
 #include <private/qwaylandwindow_p.h>
 #include <private/qwaylandinputdevice_p.h>
@@ -70,8 +71,9 @@ class DesktopAppWaylandEglWindow : public QWaylandEglWindow {
 
 	QRect geometry() const override {
 		if (!_settingGeometry) {
-			if (const auto widgetWindow = qobject_cast<const QWidgetWindow*>(
-				window())) {
+			if (window()->inherits("QWidgetWindow")) {
+				const auto widgetWindow = static_cast<QWidgetWindow*>(
+					window());
 				return widgetWindow->widget()->geometry();
 			}
 		}
