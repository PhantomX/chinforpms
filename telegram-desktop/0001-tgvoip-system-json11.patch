From 8c7e5a89ed0ba0ab7715e3f75026f933cd34b0d4 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Mon, 17 Jan 2022 08:51:39 -0300
Subject: [PATCH] tgvoip: system json11

---
 Telegram/cmake/lib_tgvoip.cmake | 14 ++++++++++++--
 1 file changed, 12 insertions(+), 2 deletions(-)

diff --git a/Telegram/cmake/lib_tgvoip.cmake b/Telegram/cmake/lib_tgvoip.cmake
index fab5e1a..1abcc83 100644
--- a/Telegram/cmake/lib_tgvoip.cmake
+++ b/Telegram/cmake/lib_tgvoip.cmake
@@ -74,8 +74,6 @@ PRIVATE
     video/VideoSource.h
     video/VideoRenderer.cpp
     video/VideoRenderer.h
-    json11.cpp
-    json11.hpp
 
     # Windows
     os/windows/NetworkSocketWinsock.cpp
@@ -123,6 +121,14 @@ PRIVATE
     os/posix/NetworkSocketPosix.h
 )
 
+if (NOT LINUX)
+nice_target_sources(lib_tgvoip_bundled ${tgvoip_loc}
+PRIVATE
+    json11.cpp
+    json11.hpp
+)
+endif()
+
 target_compile_definitions(lib_tgvoip_bundled
 PRIVATE
     TGVOIP_USE_DESKTOP_DSP
@@ -184,6 +190,10 @@ PRIVATE
 )
 
 if (LINUX)
+    find_package(PkgConfig REQUIRED)
+    pkg_check_modules(JSON11 REQUIRED IMPORTED_TARGET json11)
+    target_include_directories(lib_tgvoip_bundled SYSTEM PRIVATE ${JSON11_INCLUDE_DIRS})
+
     if (NOT LIBTGVOIP_DISABLE_ALSA)
         find_package(ALSA REQUIRED)
         target_include_directories(lib_tgvoip_bundled SYSTEM PRIVATE ${ALSA_INCLUDE_DIRS})
-- 
2.40.1

