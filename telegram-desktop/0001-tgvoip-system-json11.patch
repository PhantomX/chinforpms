From a13d40dbb24de71fe3faa952b320ca4ec8cc49e2 Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Sat, 24 Jul 2021 01:00:23 -0300
Subject: [PATCH] tgvoip: system json11

---
 Telegram/cmake/lib_tgvoip.cmake | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/Telegram/cmake/lib_tgvoip.cmake b/Telegram/cmake/lib_tgvoip.cmake
index f7007c4..9c0c34b 100644
--- a/Telegram/cmake/lib_tgvoip.cmake
+++ b/Telegram/cmake/lib_tgvoip.cmake
@@ -79,8 +79,6 @@ if (NOT TGVOIP_FOUND)
         video/VideoSource.h
         video/VideoRenderer.cpp
         video/VideoRenderer.h
-        json11.cpp
-        json11.hpp
 
         # Windows
         os/windows/NetworkSocketWinsock.cpp
@@ -189,6 +187,9 @@ if (NOT TGVOIP_FOUND)
     )
 
     if (LINUX)
+        find_package(PkgConfig REQUIRED)
+        pkg_check_modules(JSON11 REQUIRED json11)
+        target_include_directories(lib_tgvoip_bundled PRIVATE ${JSON11_INCLUDE_DIRS})
         if (NOT LIBTGVOIP_DISABLE_ALSA)
             find_package(ALSA REQUIRED)
             target_include_directories(lib_tgvoip_bundled SYSTEM PRIVATE ${ALSA_INCLUDE_DIRS})
@@ -223,6 +224,7 @@ if (NOT TGVOIP_FOUND)
         target_link_libraries(lib_tgvoip_bundled
         PRIVATE
             ${CMAKE_DL_LIBS}
+            ${JSON11_LIBRARIES}
             pthread
         )
     endif()
-- 
2.31.1

