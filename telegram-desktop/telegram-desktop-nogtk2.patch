From e834e765a07270a6861fe790745b3a04d796634f Mon Sep 17 00:00:00 2001
From: Phantom X <PhantomX@users.noreply.github.com>
Date: Thu, 12 Sep 2019 09:16:01 -0300
Subject: [PATCH] Never try to link or load GTK2

---
 Telegram/SourceFiles/platform/linux/linux_libs.cpp | 12 ------------
 Telegram/gyp/telegram_linux.gypi                   |  9 ---------
 2 files changed, 21 deletions(-)

diff --git a/Telegram/SourceFiles/platform/linux/linux_libs.cpp b/Telegram/SourceFiles/platform/linux/linux_libs.cpp
index 5071d63..671d0e6 100644
--- a/Telegram/SourceFiles/platform/linux/linux_libs.cpp
+++ b/Telegram/SourceFiles/platform/linux/linux_libs.cpp
@@ -243,24 +243,12 @@ void start() {
 			indicatorLoaded = setupAppIndicator(lib_indicator);
 		}
 	}
-	if ((!gtkLoaded || !indicatorLoaded) && !isWayland) {
-		if (loadLibrary(lib_indicator, "ayatana-appindicator", 1) || loadLibrary(lib_indicator, "appindicator", 1)) {
-			if (loadLibrary(lib_gtk, "gtk-x11-2.0", 0)) {
-				gtkLoaded = indicatorLoaded = false;
-				gtkLoaded = setupGtkBase(lib_gtk);
-				indicatorLoaded = setupAppIndicator(lib_indicator);
-			}
-		}
-	}
 
 	// If no appindicator, try at least load gtk.
 	if (!gtkLoaded && !indicatorLoaded) {
 		if (loadLibrary(lib_gtk, "gtk-3", 0)) {
 			gtkLoaded = setupGtkBase(lib_gtk);
 		}
-		if (!gtkLoaded && !isWayland && loadLibrary(lib_gtk, "gtk-x11-2.0", 0)) {
-			gtkLoaded = setupGtkBase(lib_gtk);
-		}
 	}
 
 	if (gtkLoaded) {
diff --git a/Telegram/gyp/telegram_linux.gypi b/Telegram/gyp/telegram_linux.gypi
index b314ba1..53bf64f 100644
--- a/Telegram/gyp/telegram_linux.gypi
+++ b/Telegram/gyp/telegram_linux.gypi
@@ -67,18 +67,9 @@
       ['not_need_gtk!="True"', {
         'cflags_cc': [
           '<!(pkg-config 2> /dev/null --cflags gtk+-3.0)',
-          '<!(pkg-config 2> /dev/null --cflags dee-1.0)',
         ],
-      }], ['<!(pkg-config ayatana-appindicator3-0.1; echo $?) == 0', {
-        'cflags_cc': [ '<!(pkg-config --cflags ayatana-appindicator3-0.1)' ],
-        'defines': [ 'TDESKTOP_USE_AYATANA_INDICATORS' ],
-      }], ['<!(pkg-config ayatana-appindicator-0.1; echo $?) == 0', {
-        'cflags_cc': [ '<!(pkg-config --cflags ayatana-appindicator-0.1)' ],
-        'defines': [ 'TDESKTOP_USE_AYATANA_INDICATORS' ],
       }], ['<!(pkg-config appindicator3-0.1; echo $?) == 0', {
         'cflags_cc': [ '<!(pkg-config --cflags appindicator3-0.1)' ],
-      }], ['<!(pkg-config appindicator-0.1; echo $?) == 0', {
-        'cflags_cc': [ '<!(pkg-config --cflags appindicator-0.1)' ],
       }]
     ],
   }]],
-- 
2.21.0

